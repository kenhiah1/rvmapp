<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Metro Weather | River Valley Metro</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; margin: 0; overflow: hidden; height: 100vh; }
        .app-container { width: 100vw; height: 100vh; background: #f8fafc; position: relative; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .app-container::-webkit-scrollbar { display: none; }
        
        .forecast-card { transition: transform 0.2s ease; }
        #animation-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; overflow: hidden; }
        .particle { position: absolute; top: -50px; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(100vh); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .nav-active { color: #60a5fa !important; }
        .nav-active svg { stroke: #60a5fa !important; }
    </style>
</head>

<body>

<div class="app-container">
    <div id="animation-layer"></div>

    <header class="p-6 pt-10 text-center bg-white border-b border-slate-100 sticky top-0 z-20">
        <div class="w-12 h-1.5 bg-slate-200 rounded-full mx-auto mb-6"></div>
        <h1 class="text-2xl font-black text-slate-900 tracking-tight">Weather Outlook</h1>
        <p class="text-blue-500 font-bold text-xs uppercase tracking-widest">3-Day Transit Forecast</p>
    </header>

    <div class="p-5 space-y-4 relative z-10 pb-32">
        <div class="bg-white rounded-[2.5rem] p-7 shadow-xl border border-slate-100 text-center">
            <span class="text-[10px] font-black text-blue-500 uppercase tracking-widest mb-1 block">Current Conditions</span>
            <h2 id="weather-desc" class="text-2xl font-black text-slate-900 mb-4 uppercase tracking-tight italic">Loading...</h2>
            
            <div class="flex justify-center items-baseline gap-2 mb-4">
                <span id="temp-val" class="text-6xl font-black text-slate-800">--</span>
                <span class="text-slate-400 font-bold text-2xl">¬∞F</span>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="bg-slate-50 p-4 rounded-3xl">
                    <span class="block text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1">Wind</span>
                    <span id="wind-val" class="text-sm font-black text-slate-700">-- mph</span>
                </div>
                <div class="bg-slate-50 p-4 rounded-3xl">
                    <span class="block text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1">Humidity</span>
                    <span id="hum-val" class="text-sm font-black text-slate-700">--%</span>
                </div>
            </div>
        </div>

        <div class="space-y-3" id="forecast-list"></div>

        <button onclick="fetchWeather()" class="w-full bg-slate-900 text-white py-5 rounded-[2rem] font-black shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-3 mt-4 uppercase text-xs tracking-widest">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
            Update Forecast
        </button>
    </div>
</div>

<nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[94%] max-w-[440px] bg-slate-900/95 backdrop-blur-xl border border-white/10 h-20 rounded-[2.5rem] flex items-center justify-around px-4 shadow-2xl z-[9999]">
    <a href="./status.html" class="nav-link flex flex-col items-center gap-1.5 text-slate-400 flex-1 transition-all" data-page="status.html">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
        <span class="text-[8px] font-black uppercase tracking-tighter">Alerts</span>
    </a>
    <a href="./map.html" class="nav-link flex flex-col items-center gap-1.5 text-slate-400 flex-1 transition-all" data-page="map.html">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        <span class="text-[8px] font-black uppercase tracking-tighter">Find Bus</span>
    </a>
    <a href="./midway.html" class="nav-link flex flex-col items-center gap-1.5 text-slate-400 flex-1 transition-all" data-page="midway.html">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>
        <span class="text-[8px] font-black uppercase tracking-tighter">Midway</span>
    </a>
    <a href="./passes.html" class="nav-link flex flex-col items-center gap-1.5 text-slate-400 flex-1 transition-all" data-page="passes.html">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 012-2h10a2 2 0 012 2v14a2 2 0 01-2 2H7a2 2 0 01-2-2V5z" /></svg>
        <span class="text-[8px] font-black uppercase tracking-tighter">Passes</span>
    </a>
    <a href="./weather.html" class="nav-link flex flex-col items-center gap-1.5 text-slate-400 flex-1 transition-all" data-page="weather.html">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>
        <span class="text-[8px] font-black uppercase tracking-tighter">Weather</span>
    </a>
</nav>

<script>
    const weatherCodes = {
        0: "Clear Sky", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast",
        45: "Foggy", 51: "Drizzle", 61: "Rain", 71: "Snow", 95: "Thunderstorm"
    };

    async function fetchWeather() {
        try {
            // Updated URL with current= params and specific Bourbonnais coords
            const url = "https://api.open-meteo.com/v1/forecast?latitude=41.1201&longitude=-87.8612&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&windspeed_unit=mph&timezone=America/Chicago";
            
            const response = await fetch(url);
            const data = await response.json();
            
            const current = data.current;
            document.getElementById("weather-desc").textContent = weatherCodes[current.weather_code] || "Fair";
            document.getElementById("temp-val").textContent = Math.round(current.temperature_2m);
            document.getElementById("wind-val").textContent = `${Math.round(current.wind_speed_10m)} mph`;
            document.getElementById("hum-val").textContent = `${current.relative_humidity_2m}%`;

            renderForecast(data.daily);
            renderVisuals(current.weather_code);
        } catch (e) {
            console.error("Weather fetch failed:", e);
            document.getElementById("weather-desc").textContent = "Update Failed";
        }
    }

    function renderForecast(daily) {
        const list = document.getElementById("forecast-list");
        list.innerHTML = ""; 

        for(let i=0; i<3; i++) {
            const date = new Date(daily.time[i] + "T00:00");
            const dayName = i === 0 ? "Today" : date.toLocaleDateString('en-US', { weekday: 'long' });
            const high = Math.round(daily.temperature_2m_max[i]);
            const low = Math.round(daily.temperature_2m_min[i]);
            const condition = weatherCodes[daily.weather_code[i]] || "Fair";

            const card = document.createElement("div");
            card.className = "forecast-card bg-white p-6 rounded-[2rem] border border-slate-100 shadow-sm flex justify-between items-center fade-in";
            card.style.animationDelay = `${i * 0.1}s`;
            card.innerHTML = `
                <div>
                    <span class="block text-[9px] font-black text-slate-400 uppercase tracking-widest">${dayName}</span>
                    <span class="font-black text-slate-800 uppercase text-sm">${condition}</span>
                </div>
                <div class="text-right">
                    <span class="text-xl font-black text-slate-800">${high}¬∞</span>
                    <span class="text-sm font-bold text-slate-300 ml-1">${low}¬∞</span>
                </div>
            `;
            list.appendChild(card);
        }
    }

    function renderVisuals(code) {
        const layer = document.getElementById("animation-layer");
        layer.innerHTML = "";
        if (code >= 61) { 
            const char = code >= 71 ? "‚ùÑÔ∏è" : "üíß";
            for(let i=0; i<30; i++) {
                const p = document.createElement("div");
                p.className = "particle";
                p.textContent = char;
                p.style.left = Math.random() * 100 + "vw";
                p.style.animationDuration = (Math.random() * 2 + 2) + "s";
                p.style.opacity = Math.random();
                layer.appendChild(p);
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const path = window.location.pathname.split("/").pop() || "weather.html";
        document.querySelectorAll('.nav-link').forEach(link => {
            if(link.getAttribute('data-page') === path) link.classList.add('nav-active');
        });
        fetchWeather();
    });
</script>
</body>
</html>
