<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>RVM Digital Schedule</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; margin: 0; padding: 0; overflow: hidden; height: 100vh; }
    .app-container { width: 100vw; height: 100vh; max-width: 430px; background: #f8fafc; margin: 0 auto; position: relative; overflow: hidden; display: flex; flex-direction: column; }
    
    .main-content { flex: 1; overflow-y: auto; padding: 1.5rem; padding-bottom: 180px; }
    
    /* FIX: Adjusted bottom position and z-index to stay above nav */
    .drawer { 
      position: absolute; 
      bottom: 0; 
      left: 0; 
      right: 0; 
      background: #f1f5f9; 
      border-radius: 30px 30px 0 0; 
      z-index: 50; 
      transform: translateY(calc(100% - 160px)); /* Shows handle above nav */
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
      max-height: 85vh; 
      display: flex; 
      flex-direction: column; 
      box-shadow: 0 -10px 40px rgba(0,0,0,0.3); 
    }
    .drawer.open { transform: translateY(0) !important; }
    
    .drawer-handle { 
      height: 75px; 
      flex-shrink: 0; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      background: white; 
      border-radius: 30px 30px 0 0; 
      border-bottom: 1px solid #e2e8f0; 
      cursor: pointer;
    }

    .scroll-hide::-webkit-scrollbar { display: none; }
    
    .dir-toggle { display: none; background: #e2e8f0; border-radius: 12px; padding: 4px; margin-bottom: 24px; }
    .dir-toggle button { flex: 1; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: 800; transition: 0.3s; }
    .dir-toggle button.active { background: #239ed9; color: white; box-shadow: 0 4px 12px rgba(35, 158, 217, 0.3); }
    
    .nav-link.active { color: #38bdf8; }
  </style>
</head>
<body>

  <div class="app-container">
    <div class="main-content scroll-hide">
      <div class="pt-4 mb-6">
        <h1 class="text-2xl font-extrabold text-slate-900 leading-tight">River Valley Metro</h1>
        <p class="text-sky-500 font-bold text-xs uppercase tracking-widest">Digital Schedule</p>
      </div>

      <input type="text" id="destSearch" onkeyup="searchDest()" placeholder="Search stops..." class="w-full bg-white border border-slate-200 p-4 rounded-2xl mb-4 shadow-sm outline-none focus:ring-2 focus:ring-sky-500/20">

      <select id="routeSelect" onchange="initRoute()" class="w-full bg-white border border-slate-200 p-4 rounded-2xl mb-6 font-bold text-slate-700 shadow-sm appearance-none">
        <option value="">-- Select Route --</option>
        <option value="1">Route 1 - Meadowview</option>
        <option value="2">Route 2 - Mall / Walmart</option>
        <option value="3">Route 3 - Target / Bradley</option>
        <option value="4">Route 4 - East Court Village</option>
        <option value="5">Route 5 - Aroma Park</option>
        <option value="6">Route 6 - KCC (M-F)</option>
        <option value="7NP">Route 7 - Non-Peak</option>
        <option value="7P">Route 7 - Peak Service</option>
        <option value="8">Route 8 - KHS / Jewel</option>
        <option value="9">Route 9 - Manteno</option>
        <option value="10">Route 10 - Bourbonnais</option>
        <option value="11">Route 11 - ONU / Mall</option>
        <option value="12">Route 12 - Meijer / Perry Farm</option>
        <option value="14">Route 14 - Merchant St</option>
      </select>

      <div id="route4Toggle" class="dir-toggle flex gap-2">
        <button id="btnEast" class="active" onclick="setDir('east')">EASTBOUND</button>
        <button id="btnWest" onclick="setDir('west')">WESTBOUND</button>
      </div>

      <div id="etaDisplay" style="display:none;" class="bg-slate-900 rounded-[32px] p-8 text-white shadow-2xl">
        <p class="text-sky-400 font-extrabold text-xs uppercase mb-2" id="dirLabel">Scheduled Arrival</p>
        <h2 id="stopName" class="text-2xl font-extrabold mb-6">--</h2>
        <div class="flex items-baseline gap-2 mb-6">
          <span id="bigTime" class="text-6xl font-black tracking-tighter">--:--</span>
          <span id="ampm" class="text-xl font-bold opacity-40">--</span>
        </div>
        <div id="badge" class="inline-flex items-center gap-2 bg-sky-500/20 text-sky-400 px-4 py-2 rounded-full border border-sky-500/30">
          <span id="minsAway" class="text-sm font-extrabold uppercase">Calculating...</span>
        </div>
      </div>
    </div>

    <div id="drawer" class="drawer">
      <div class="drawer-handle" onclick="toggleDrawer()">
        <div class="w-12 h-1.5 bg-slate-300 rounded-full mb-3"></div>
        <span class="text-slate-900 font-extrabold text-[10px] uppercase tracking-[0.2em]">View Full Schedule</span>
      </div>
      <div id="fullSchedList" class="flex-1 overflow-y-auto px-6 py-6 space-y-3 bg-slate-100">
        <p class="text-center text-slate-400 text-sm italic">Select a route to view times</p>
      </div>
    </div>

    <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[94%] max-w-[440px] bg-slate-900/95 backdrop-blur-xl border border-white/10 h-20 rounded-[2.5rem] flex items-center justify-around px-4 shadow-2xl z-[100]">
      <a href="#" class="nav-link flex flex-col items-center gap-1 text-slate-400 flex-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>
        <span class="text-[8px] font-black uppercase">Alerts</span>
      </a>
      <a href="#" class="nav-link active flex flex-col items-center gap-1 flex-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
        <span class="text-[8px] font-black uppercase">Schedule</span>
      </a>
    </nav>
  </div>

  <script>
    let currentDir = 'east';
    const routeData = {
      "1": { startH: 5, endH: 21, stops: [["Family Dollar", 5], ["Azzarelli Apts", 8], ["St. Mary's", 15], ["Walgreens Court", 19], ["Metro Centre", 25], ["Family Dollar", 35], ["Azzarelli Apts", 38], ["St. Mary's", 45], ["Walgreens Court", 49], ["Metro Centre", 55]] },
      "2": { startH: 5, endH: 21, stops: [["Meijer (NB)", 7], ["Walmart", 14], ["Signature/Jack", 19], ["Northfield Mall", 25], ["Mall (Dep)", 30], ["Signature/Jack", 33], ["Adventure Church", 38], ["Meijer (SB)", 45], ["Broadway Shelter", 51], ["Village Hall", 58]] },
      "3": { startH: 5, endH: 21, stops: [["Metro Centre", 0], ["Bradley Library", 6], ["Christine/Leo", 13], ["Target", 20], ["Northfield Mall", 30], ["Target (Ret)", 32], ["Christine (Meijer)", 39], ["Village Square", 44], ["KCTC", 49]] },
      "4": {
        startH: 5, endH: 21,
        east: [["East Court Village", 7], ["Frontage Road", 13], ["Spruce/Fairmont", 15], ["Family Dollar", 18], ["Metro Centre", 30], ["East Court Village", 37], ["Frontage Road", 43], ["Spruce/Fairmont", 45], ["Family Dollar", 48], ["Metro Centre", 0]],
        west: [["West - St. Mary's", 33], ["West - Riverside Med", 40], ["West - Health Dept", 45], ["Metro Centre", 0], ["West - St. Mary's", 3], ["West - Riverside Med", 10], ["West - Health Dept", 15], ["Metro Centre", 30]]
      },
      "5": { startH: 5, endH: 21, stops: [["Aroma Park Shelter", 30], ["Crestview", 35], ["Riverside East", 38], ["Maple/Eagle", 41], ["Eagle/Chicago", 46], ["Metro Centre", 0], ["Eagle/Chicago", 6], ["Dollar General", 13], ["Crestview", 16]] },
      "6": { startH: 7, startM: 30, endH: 17, stops: [["Metro Centre", 30], ["Kankakee Estates", 36], ["K.C.C", 41], ["Del Monte", 46], ["Walmart", 58], ["Jerome Combs", 8], ["Schuyler/River", 18]] },
      "7NP": { startH: 5, endH: 21, stops: [["Metro Centre", 0], ["Kankakee Estates", 6], ["Del Monte", 8], ["K.C.C.", 16], ["Walmart Kankakee", 22], ["Jerome Combs", 29], ["Love's", 34], ["Walmart Kankakee", 40], ["Harrison/Station", 48]] },
      "7P": { startH: 5, endH: 21, stops: [["Metro Centre", 0], ["Kankakee Estates", 6], ["K.C.C", 11], ["Walmart Kankakee", 15], ["Harrison/Station", 22], ["Metro Centre", 30], ["Kankakee Estates", 36], ["Walmart Kankakee", 42], ["Harrison/Station", 49]] },
      "8": { startH: 5, endH: 21, stops: [["Metro Centre", 0], ["Washington/Water", 3], ["Casey's (Jeffery)", 8], ["Merchant/Curtis", 12], ["KHS", 15], ["Jewel (Wash)", 19], ["Metro Centre", 30], ["Mulberry/Chicago", 33], ["Hobbie/Willow", 36], ["Broadway/Jeff", 42], ["Brookmont/Harvard", 48]] },
      "9": { startH: 5, endH: 21, stops: [["Manteno Metro", 0], ["ABC Supply", 7], ["Northfield Mall", 30], ["Walmart", 33], ["Manteno Metro", 41], ["E. 2nd St", 45], ["Veterans' Home", 52]] },
      "10": { startH: 5, endH: 21, stops: [["Brown Blvd", 0], ["Casey's", 5], ["Riverside Campus", 7], ["Bourbonnais Metro", 13], ["Northfield Mall", 30], ["Casey's", 34], ["Riverside Campus", 36], ["Bourbonnais Metro", 42], ["W. Bethel Dr", 50], ["Almar Parkway", 55]] },
      "11": { startH: 5, endH: 21, stops: [["Metro Centre", 0], ["McDonald's (5th)", 4], ["ONU", 11], ["Northfield Meadows", 18], ["Northfield Mall", 30], ["Kroger", 36], ["ONU", 42], ["Walgreens Kennedy", 48]] },
      "12": { startH: 5, endH: 21, stops: [["Metro Centre", 30], ["McDonald's (5th)", 34], ["Shine FM", 39], ["Meijer", 47], ["Kroger", 55], ["Brown Blvd", 2], ["Heritage/Convent", 11], ["Perry Farm", 16], ["Walgreen's", 19], ["Metro Centre", 25]] },
      "14": { startH: 5, endH: 21, stops: [["Metro Centre", 0], ["Mulberry/Chicago", 2], ["Fairmont/Court", 9], ["Eagle/Maple", 13], ["Harrison/Station", 20], ["Metro Centre", 30], ["Station/Schuyler", 33], ["Mercy Housing", 37], ["Merchant/Curtis", 41], ["KHS", 45], ["Kankakee Jewel", 49]] }
    };

    function initRoute() {
      const rid = document.getElementById('routeSelect').value;
      if(!rid) return;
      document.getElementById('route4Toggle').style.display = (rid === "4") ? "flex" : "none";
      document.getElementById('etaDisplay').style.display = 'block';
      updateLiveETA();
      buildFullSchedule();
    }

    function setDir(dir) {
      currentDir = dir;
      document.getElementById('btnEast').className = (dir === 'east') ? 'active' : '';
      document.getElementById('btnWest').className = (dir === 'west') ? 'active' : '';
      updateLiveETA();
      buildFullSchedule();
    }

    function updateLiveETA() {
      const rid = document.getElementById('routeSelect').value;
      const now = new Date();
      const curH = now.getHours();
      const curM = now.getMinutes();
      const route = routeData[rid];

      const startH = route.startH || 5;
      const startM = route.startM || 0;
      if ((curH < startH) || (curH >= route.endH)) {
        document.getElementById('stopName').innerText = "Service Offline";
        document.getElementById('bigTime').innerText = "--:--";
        document.getElementById('minsAway').innerText = "NOT RUNNING";
        return;
      }

      let activeStops = (rid === "4") ? route[currentDir] : route.stops;
      const sorted = [...activeStops].sort((a,b) => a[1] - b[1]);
      let next = sorted.find(s => s[1] >= curM);
      let h = curH;

      if (!next) { next = sorted[0]; h = curH + 1; }

      document.getElementById('stopName').innerText = next[0];
      document.getElementById('bigTime').innerText = `${h % 12 || 12}:${next[1].toString().padStart(2, '0')}`;
      document.getElementById('ampm').innerText = h >= 12 ? 'PM' : 'AM';
      const diff = (h > curH) ? (60 - curM + next[1]) : (next[1] - curM);
      document.getElementById('minsAway').innerText = diff === 0 ? "AT STOP" : "IN " + diff + " MINS";
    }

    function buildFullSchedule() {
      const rid = document.getElementById('routeSelect').value;
      const route = routeData[rid];
      const now = new Date();
      const currentTotalMins = (now.getHours() * 60) + now.getMinutes();
      
      let html = "";
      let activeStops = (rid === "4") ? route[currentDir] : route.stops;
      const startH = route.startH || 5;

      for(let h = startH; h < route.endH; h++) {
        [...activeStops].sort((a,b) => a[1] - b[1]).forEach(s => {
          const stopTotalMins = (h * 60) + s[1];
          const isNext = stopTotalMins >= currentTotalMins && stopTotalMins < currentTotalMins + 30;
          
          html += `
            <div class="flex justify-between items-center p-4 bg-white rounded-2xl border ${isNext ? 'border-sky-500 ring-1 ring-sky-500' : 'border-slate-200'} shadow-sm">
              <div class="flex flex-col">
                <span class="font-bold text-slate-900 text-sm">${s[0]}</span>
                ${isNext ? '<span class="text-[10px] text-sky-500 font-black uppercase">Next Bus</span>' : ''}
              </div>
              <span class="font-extrabold text-slate-900 text-sm">${h % 12 || 12}:${s[1].toString().padStart(2, '0')} ${h >= 12 ? 'PM' : 'AM'}</span>
            </div>`;
        });
      }
      document.getElementById('fullSchedList').innerHTML = html;
    }

    function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }
    
    function searchDest() {
      const q = document.getElementById('destSearch').value.toLowerCase();
      if(q.length < 3) return;
      for (let id in routeData) {
        const stops = id === "4" ? [...routeData[id].east, ...routeData[id].west] : routeData[id].stops;
        if (stops.some(s => s[0].toLowerCase().includes(q))) {
          document.getElementById('routeSelect').value = id;
          initRoute();
          break;
        }
      }
    }
  </script>
</body>
</html>
