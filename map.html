<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>System Map | River Valley Metro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #4779c4; color: #1e293b; margin: 0; padding-bottom: 120px; }
    .glass-card { background: rgba(255, 255, 255, 0.98); border-radius: 28px; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 15px 35px rgba(0,0,0,0.2); }
    .status-dark { background: #0f172a; color: white; border-radius: 32px; transition: all 0.4s ease; }
    @keyframes pulse-soft { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    .arriving-pulse { animation: pulse-soft 2s infinite ease-in-out; border: 2px solid #60a5fa; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .drawer { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-radius: 32px 32px 0 0; z-index: 50; transform: translateY(calc(100% - 100px)); transition: 0.5s cubic-bezier(0.4, 0, 0.2, 1); height: 70vh; }
    .drawer.open { transform: translateY(-80px); }
    .nav-active { color: #60a5fa !important; }
  </style>
</head>
<body class="p-4 no-scrollbar">

  <div class="flex justify-between items-start mb-6 pt-4 px-2">
    <div>
      <h1 class="text-white text-3xl font-extrabold tracking-tight">Metro Guide</h1>
      <p id="serviceTag" class="text-blue-100 font-bold opacity-80 text-xs uppercase tracking-widest">Checking Service...</p>
    </div>
    <div class="bg-white/20 backdrop-blur-md px-4 py-2 rounded-2xl text-white text-[10px] font-black">2026 OFFICIAL</div>
  </div>

  <div class="grid grid-cols-2 gap-4 mb-6">
    <button onclick="openSearch()" class="glass-card p-5 flex flex-col items-start active:scale-95 transition-transform">
      <div class="bg-blue-100 w-10 h-10 rounded-xl flex items-center justify-center text-xl mb-3">üìç</div>
      <span class="font-extrabold text-slate-800 text-sm">Find Stop</span>
      <span class="text-[10px] text-slate-400 font-bold">Search Locations</span>
    </button>
    <a href="tel:8159374287" class="glass-card p-5 flex flex-col items-start active:scale-95 transition-transform">
      <div class="bg-red-100 w-10 h-10 rounded-xl flex items-center justify-center text-xl mb-3">üìû</div>
      <span class="font-extrabold text-slate-800 text-sm">Help Desk</span>
      <span class="text-[10px] text-slate-400 font-bold">815-937-4287</span>
    </a>
  </div>

  <div class="glass-card p-2 mb-6 shadow-xl">
    <select id="routeSelect" onchange="initRoute()" class="w-full bg-transparent border-none p-4 text-lg font-extrabold text-slate-900 outline-none appearance-none cursor-pointer">
      <option value="">Choose your Bus Route...</option>
      <option value="1">Route 1 - Meadowview</option>
      <option value="2">Route 2 - Mall / Walmart</option>
      <option value="3">Route 3 - Target / Bradley</option>
      <option value="4">Route 4 - Court Village / St. Marys</option>
      <option value="5">Route 5 - Aroma Park</option>
      <option value="6">Route 6 - KCC (M-F ONLY)</option>
      <option value="7NP">Route 7 - Non-Peak</option>
      <option value="7P">Route 7 - Peak Service</option>
      <option value="8">Route 8 - KHS / Jewel</option>
      <option value="9">Route 9 - Manteno</option>
      <option value="10">Route 10 - Bourbonnais</option>
      <option value="11">Route 11 - ONU / Mall</option>
      <option value="12">Route 12 - Meijer / Perry Farm</option>
      <option value="14">Route 14 - Merchant St</option>
    </select>
  </div>

  <div id="etaDisplay" style="display:none;" class="status-dark p-8 mb-6 shadow-2xl">
    <div id="route4Toggle" class="hidden grid grid-cols-2 gap-2 mb-8 bg-white/5 p-1 rounded-2xl">
        <button id="btnEast" class="py-3 rounded-xl font-black text-[10px] bg-white text-slate-900 shadow-lg" onclick="setDir('east')">EASTBOUND</button>
        <button id="btnWest" class="py-3 rounded-xl font-black text-[10px] text-white" onclick="setDir('west')">WESTBOUND</button>
    </div>
    <div class="flex justify-between items-start mb-2">
        <p class="text-blue-400 font-black text-[10px] uppercase tracking-[0.2em]">Next Bus</p>
        <span id="countdownBadge" class="bg-blue-600 px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-tighter">Updating</span>
    </div>
    <h2 id="stopName" class="text-2xl font-black mb-6 leading-tight tracking-tight">--</h2>
    <div class="flex items-baseline mb-8">
        <span id="bigTime" class="text-6xl font-black tracking-tighter">--:--</span>
        <span id="ampm" class="text-xl font-bold opacity-30 ml-2 uppercase">--</span>
    </div>
    <div class="bg-white/5 rounded-2xl p-4 border border-white/5">
        <p id="passengerTip" class="text-xs font-bold text-blue-100/70 leading-relaxed italic">Stand at the bus stop sign.</p>
    </div>
  </div>

  <div id="searchModal" class="fixed inset-0 z-[1000] bg-white hidden flex-col p-6 no-scrollbar">
    <div class="flex justify-between items-center mb-8">
        <h2 class="text-3xl font-black tracking-tight text-slate-900">Locations</h2>
        <button onclick="closeSearch()" class="w-12 h-12 rounded-2xl bg-slate-100 flex items-center justify-center font-bold text-xl">‚úï</button>
    </div>
    <input type="text" id="modalInput" onkeyup="filterStops()" placeholder="Where are you going?" class="w-full p-5 bg-slate-100 rounded-2xl mb-6 outline-none font-bold text-lg border-2 border-transparent focus:border-blue-500 transition-all">
    <div id="stopGrid" class="flex-1 overflow-y-auto space-y-3 no-scrollbar pb-10"></div>
  </div>

  <div id="drawer" class="drawer shadow-2xl">
    <div class="h-[85px] flex flex-col items-center justify-center cursor-pointer" onclick="toggleDrawer()">
        <div class="w-12 h-1.5 bg-slate-200 rounded-full mb-3"></div>
        <p class="font-black text-[10px] text-slate-400 uppercase tracking-[0.3em]">Full Timetable</p>
    </div>
    <div id="fullSchedList" class="p-6 overflow-y-auto h-full pb-32 no-scrollbar bg-slate-50"></div>
  </div>

  <nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[92%] max-w-[400px] bg-slate-900/95 backdrop-blur-xl border border-white/10 h-16 rounded-2xl flex items-center justify-around px-2 shadow-2xl z-[9000]">
    <a href="./index.html" class="nav-link flex flex-col items-center gap-1 text-slate-400 py-2 flex-1" data-page="index.html">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
      <span class="text-[8px] font-bold uppercase tracking-tighter">Home</span>
    </a>
    <a href="./tracker.html" class="nav-link flex flex-col items-center gap-1 text-slate-400 py-2 flex-1" data-page="tracker.html">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
      <span class="text-[8px] font-bold uppercase tracking-tighter">Live</span>
    </a>
    <a href="./map.html" class="nav-link flex flex-col items-center gap-1 text-slate-400 py-2 flex-1" data-page="map.html">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>
      <span class="text-[8px] font-bold uppercase tracking-tighter">Map</span>
    </a>
    <a href="./status.html" class="nav-link flex flex-col items-center gap-1 text-slate-400 py-2 flex-1" data-page="status.html">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      <span class="text-[8px] font-bold uppercase tracking-tighter">Status</span>
    </a>
  </nav>

  <script>
    // NAVIGATION LOGIC
    const path = window.location.pathname.split("/").pop() || "map.html";
    document.querySelectorAll('.nav-link').forEach(link => {
      if(link.getAttribute('data-page') === path) link.classList.add('nav-active');
    });

    // DATA & SCHEDULING LOGIC
    const routeData = {
      "1": { stops: [["Family Dollar", 5], ["Azzarelli Apts", 8], ["St. Mary's", 15], ["Walgreens Court", 19], ["Metro Centre", 25]] },
      "2": { stops: [["Meijer (NB)", 7], ["Walmart", 14], ["Northfield Mall", 25], ["Village Hall", 58]] },
      "3": { stops: [["Metro Centre", 0], ["Bradley Library", 6], ["Target", 20], ["Village Square", 44]] },
      "4": { east: [["East Court Village", 7], ["Metro Centre", 30]], west: [["West - St. Mary's", 33], ["West - Health Dept", 45]] },
      "5": { stops: [["Aroma Park Shelter", 30], ["Crestview", 35], ["Riverside East", 38]] },
      "6": { stops: [["Metro Centre", 30], ["K.C.C", 41], ["Del Monte", 46], ["Walmart", 58]], weekdayOnly: true },
      "7NP": { stops: [["Metro Centre", 0], ["K.C.C.", 16], ["Walmart Kankakee", 22]] },
      "7P": { stops: [["Metro Centre", 0], ["K.C.C", 11], ["Walmart Kankakee", 15]] },
      "8": { stops: [["Metro Centre", 0], ["KHS", 15], ["Jewel (Wash)", 19]] },
      "9": { stops: [["Manteno Metro", 0], ["ABC Supply", 7], ["Northfield Mall", 30]] },
      "10": { stops: [["Brown Blvd", 0], ["Bourbonnais Metro", 13], ["Almar Parkway", 55]] },
      "11": { stops: [["Metro Centre", 0], ["ONU", 11], ["Northfield Mall", 30]] },
      "12": { stops: [["Metro Centre", 30], ["Meijer", 47], ["Perry Farm", 16]] },
      "14": { stops: [["Metro Centre", 0], ["Mercy Housing", 37], ["Kankakee Jewel", 49]] }
    };

    let currentDir = 'east';

    function getServiceHours(rid) {
      const now = new Date();
      const month = now.getMonth() + 1;
      const date = now.getDate();
      const day = now.getDay();
      const tag = document.getElementById('serviceTag');
      const isHoliday = (month === 1 && date === 1) || (month === 12 && date === 25);

      if (rid === "6") {
          if (day === 0 || day === 6 || isHoliday) return { closed: true, label: "Weekdays Only" };
          tag.innerText = "Weekday Service";
          return { start: 7.5, end: 17, label: "7:30 AM", endLabel: "5:00 PM" };
      }
      if (isHoliday || day === 0) {
          tag.innerText = isHoliday ? "Holiday Service" : "Sunday Service";
          return { start: 8, end: 16, label: "8:00 AM", endLabel: "4:00 PM" };
      }
      if (day === 6) { tag.innerText = "Saturday Service"; return { start: 7, end: 21.5, label: "7:00 AM", endLabel: "9:30 PM" }; }
      tag.innerText = "Weekday Service";
      return { start: 5, end: 21.5, label: "5:00 AM", endLabel: "9:30 PM" };
    }

    function initRoute() {
      const rid = document.getElementById('routeSelect').value;
      if(!rid) return;
      document.getElementById('route4Toggle').style.display = (rid === "4") ? "grid" : "none";
      document.getElementById('etaDisplay').style.display = 'block';
      updateLiveETA(); buildFullSchedule();
    }

    function updateLiveETA() {
      const rid = document.getElementById('routeSelect').value;
      if (!rid) return;
      const now = new Date();
      const h_now = now.getHours();
      const m_now = now.getMinutes();
      const hours = getServiceHours(rid);
      const dec_now = h_now + (m_now / 60);

      const display = document.getElementById('etaDisplay');
      const stopEl = document.getElementById('stopName');
      const timeEl = document.getElementById('bigTime');
      const badge = document.getElementById('countdownBadge');

      if (dec_now < hours.start || dec_now >= hours.end) {
          stopEl.innerText = "Service Closed";
          timeEl.innerText = "--:--";
          badge.innerText = "Offline";
          return;
      }

      const route = routeData[rid];
      let stops = (rid === "4") ? route[currentDir] : route.stops;
      let next = stops.find(s => s[1] >= m_now) || stops[0];
      let h_bus = (stops.find(s => s[1] >= m_now)) ? h_now : h_now + 1;

      stopEl.innerText = next[0];
      timeEl.innerText = `${h_bus % 12 || 12}:${next[1].toString().padStart(2, '0')}`;
      document.getElementById('ampm').innerText = h_bus >= 12 ? 'PM' : 'AM';
      
      const diff = (h_bus > h_now) ? (60 - m_now + next[1]) : (next[1] - m_now);
      badge.innerText = diff <= 5 ? "Arriving" : diff + " Mins";
    }

    function buildFullSchedule() {
      const rid = document.getElementById('routeSelect').value;
      const hours = getServiceHours(rid);
      const list = document.getElementById('fullSchedList');
      let stops = (rid === "4") ? routeData[rid][currentDir] : routeData[rid].stops;
      let html = "";
      for(let h = Math.floor(hours.start); h < Math.floor(hours.end); h++) {
          stops.forEach(s => {
              html += `<div class="flex justify-between items-center p-4 mb-2 bg-white rounded-xl border border-slate-100 shadow-sm">
                  <span class="font-bold text-slate-700 text-xs">${s[0]}</span>
                  <span class="font-black text-blue-600 text-xs">${h % 12 || 12}:${s[1].toString().padStart(2, '0')} ${h >= 12 ? 'PM' : 'AM'}</span>
              </div>`;
          });
      }
      list.innerHTML = html;
    }

    function openSearch() { document.getElementById('searchModal').style.display = 'flex'; loadSearch(); }
    function closeSearch() { document.getElementById('searchModal').style.display = 'none'; }
    function loadSearch() {
        const grid = document.getElementById('stopGrid');
        let allStops = [];
        for (let rid in routeData) {
            let stops = rid === "4" ? [...routeData[rid].east, ...routeData[rid].west] : routeData[rid].stops;
            stops.forEach(s => allStops.push({ name: s[0], id: rid }));
        }
        allStops = [...new Map(allStops.map(item => [item.name, item])).values()].sort((a,b) => a.name.localeCompare(b.name));
        grid.innerHTML = allStops.map(s => `
            <button onclick="selectFromSearch('${s.id}')" class="w-full text-left p-5 bg-slate-50 rounded-2xl font-bold mb-2">
                ${s.name} <span class="block text-[10px] text-blue-500 font-black">Route ${s.id}</span>
            </button>
        `).join('');
    }
    function selectFromSearch(rid) { document.getElementById('routeSelect').value = rid; initRoute(); closeSearch(); }
    function filterStops() {
        const q = document.getElementById('modalInput').value.toLowerCase();
        const btns = document.getElementById('stopGrid').querySelectorAll('button');
        btns.forEach(b => b.style.display = b.innerText.toLowerCase().includes(q) ? 'block' : 'none');
    }
    function setDir(dir) { currentDir = dir; updateLiveETA(); buildFullSchedule(); }
    function toggleDrawer() { document.getElementById('drawer').classList.toggle('open'); }
    setInterval(updateLiveETA, 30000);
  </script>
</body>
</html>
